<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Darkroom â€” Drive Media Manager</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400;1,700&family=Syne:wght@400;500;600;700;800&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <!-- Load config.js if present (gitignored â€” never committed). Copy config.example.js â†’ config.js to set your API key. -->
  <script src="config.js" onerror="void 0"></script>
  <!-- JSZip: client-side ZIP generation (M4) -->
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <!-- Vercel Web Analytics -->
  <script>
    window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
  </script>
  <script defer src="/_vercel/insights/script.js"></script>
</head>

<body>

<!-- ===================================
     HEADER
=================================== -->
<header>
  <div class="logo">
    Darkroom
    <sub>Drive Media Manager</sub>
  </div>

  <!-- Pricing link (M11) -->
  <a class="pricing-link" href="pricing.html">Pricing</a>

  <button class="fav-hdr-btn hidden" id="fav-hdr-btn" aria-label="Show favorites" title="Show favorites">
    <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24"
         fill="currentColor" stroke="none">
      <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
    </svg>
    <span id="fav-count">0</span>
  </button>

  <!-- Sign in / user profile (M7) -->
  <button class="sign-in-btn" id="sign-in-btn" aria-label="Sign in with Google" title="Sign in with Google to browse private folders">
    <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24"
         fill="none" stroke="currentColor" stroke-width="2"
         stroke-linecap="round" stroke-linejoin="round">
      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
      <circle cx="12" cy="7" r="4"/>
    </svg>
    Sign in
  </button>

  <div class="user-pill hidden" id="user-pill">
    <div class="user-avatar" id="user-avatar">U</div>
    <span class="user-name" id="user-name"></span>
    <button class="user-signout" id="sign-out-btn" aria-label="Sign out" title="Sign out">
      <svg xmlns="http://www.w3.org/2000/svg" width="11" height="11" viewBox="0 0 24 24"
           fill="none" stroke="currentColor" stroke-width="2.5"
           stroke-linecap="round" stroke-linejoin="round">
        <path d="M18 6 6 18M6 6l12 12"/>
      </svg>
    </button>
  </div>

  <!-- New Event button (M13) â€” visible when host is signed in -->
  <button class="new-event-hdr-btn hidden" id="new-event-btn-hdr" aria-label="Create new event" title="Create a new photo collection event">
    <svg xmlns="http://www.w3.org/2000/svg" width="11" height="11" viewBox="0 0 24 24"
         fill="none" stroke="currentColor" stroke-width="2.5"
         stroke-linecap="round" stroke-linejoin="round">
      <line x1="12" y1="5" x2="12" y2="19"/>
      <line x1="5" y1="12" x2="19" y2="12"/>
    </svg>
    Event
  </button>

  <!-- Protect gallery button (M12) -->
  <button class="protect-btn hidden" id="protect-btn" aria-label="Password-protect this gallery" title="Password-protect this gallery">
    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
         fill="none" stroke="currentColor" stroke-width="2"
         stroke-linecap="round" stroke-linejoin="round">
      <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
      <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
    </svg>
  </button>

  <!-- Embed code button (M9) -->
  <button class="embed-btn hidden" id="embed-btn" aria-label="Get embed code" title="Embed this gallery on your website">
    <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24"
         fill="none" stroke="currentColor" stroke-width="2"
         stroke-linecap="round" stroke-linejoin="round">
      <polyline points="16 18 22 12 16 6"/>
      <polyline points="8 6 2 12 8 18"/>
    </svg>
  </button>

  <button class="copy-link-btn hidden" id="copy-link-btn" aria-label="Copy gallery link" title="Copy gallery link">
    <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24"
         fill="none" stroke="currentColor" stroke-width="2"
         stroke-linecap="round" stroke-linejoin="round">
      <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
      <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
    </svg>
  </button>

  <button class="settings-btn" id="settings-btn" aria-label="API key settings" title="API key settings">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
         fill="none" stroke="currentColor" stroke-width="2"
         stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="3"/>
      <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
    </svg>
    <span class="api-key-dot" id="api-key-dot"></span>
  </button>

  <form class="folder-form" id="folder-form">
    <div class="input-wrap">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
           stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
      </svg>
      <input class="folder-input" id="folder-input" type="text"
             placeholder="Paste Google Drive folder URL or IDâ€¦"
             autocomplete="off" spellcheck="false">
    </div>
    <button type="submit" class="browse-btn">Browse</button>
  </form>
</header>

<!-- ===================================
     MAIN
=================================== -->
<main>

  <!-- LANDING -->
  <div class="landing" id="landing">
    <div class="landing-orb">
      <svg xmlns="http://www.w3.org/2000/svg" width="52" height="52" viewBox="0 0 24 24"
           fill="none" stroke="currentColor" stroke-width="1.5"
           stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="3" width="7" height="7" rx="1"/>
        <rect x="14" y="3" width="7" height="7" rx="1"/>
        <rect x="3" y="14" width="7" height="7" rx="1"/>
        <rect x="14" y="14" width="7" height="7" rx="1"/>
      </svg>
    </div>
    <h1>Your media,<em>developed.</em></h1>
    <!-- Tagline cycler (M11) -->
    <div class="tagline-cycle" id="tagline-cycle"></div>
    <p class="landing-desc">
      Paste a Google Drive folder link or ID above to explore photos, videos, and files
      in a cinematic gallery â€” instant, beautiful, organized.
    </p>
    <div class="landing-steps">
      <div class="step"><div class="step-n">01</div>Share folder publicly</div>
      <div class="step"><div class="step-n">02</div>Paste URL or folder ID</div>
      <div class="step"><div class="step-n">03</div>Browse your media</div>
    </div>
    <!-- Social proof + demo link (M11) -->
    <div class="social-proof">
      Trusted by photographers, families, and teams
      <span class="social-count">2,400+ galleries created</span>
    </div>
    <button class="demo-link" id="demo-link">Try with a demo gallery â†’</button>

    <!-- Event Dashboard (M13) â€” visible after sign-in when events exist -->
    <div class="event-dashboard hidden" id="event-dashboard">
      <div class="event-dashboard-hdr">
        <span class="event-dashboard-title">Your Events</span>
        <button class="event-new-btn" id="new-event-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="11" height="11" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2.5"
               stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
          New Event
        </button>
      </div>
      <div class="event-list" id="event-list"></div>
    </div>
  </div>

  <!-- GALLERY -->
  <div id="gallery-container" class="hidden">

    <div class="stats-bar" id="stats-bar"></div>

    <div class="toolbar">
      <nav class="breadcrumb" id="breadcrumb" aria-label="Folder navigation"></nav>

      <div style="flex:1"></div>

      <div class="search-wrap">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
        </svg>
        <input class="search-input" id="search-input" type="search" placeholder="Search filesâ€¦">
      </div>

      <div class="filter-tabs" role="group" aria-label="Filter by type">
        <button class="ftab active" data-filter="all">All</button>
        <button class="ftab" data-filter="image">Images</button>
        <button class="ftab" data-filter="video">Videos</button>
        <button class="ftab" data-filter="folder">Folders</button>
        <button class="ftab" data-filter="doc">Docs</button>
        <button class="ftab ftab-fav" data-filter="favorites">â™¡ Favs</button>
      </div>

      <!-- View mode toggle (M10) -->
      <div class="view-toggle" id="view-toggle" role="group" aria-label="View mode">
        <button class="view-btn active" id="view-grid-btn" data-view="grid" aria-label="Grid view" title="Grid view">
          <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="7" height="7" rx="1"/>
            <rect x="14" y="3" width="7" height="7" rx="1"/>
            <rect x="3" y="14" width="7" height="7" rx="1"/>
            <rect x="14" y="14" width="7" height="7" rx="1"/>
          </svg>
        </button>
        <button class="view-btn" id="view-timeline-btn" data-view="timeline" aria-label="Timeline view" title="Timeline view">
          <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round">
            <line x1="8" y1="6" x2="21" y2="6"/>
            <line x1="8" y1="12" x2="21" y2="12"/>
            <line x1="8" y1="18" x2="21" y2="18"/>
            <line x1="3" y1="6" x2="3.01" y2="6"/>
            <line x1="3" y1="12" x2="3.01" y2="12"/>
            <line x1="3" y1="18" x2="3.01" y2="18"/>
          </svg>
        </button>
      </div>

      <!-- Print timeline (M10) -->
      <button class="print-btn hidden" id="print-btn" aria-label="Print timeline" title="Print / Save as PDF">
        <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round">
          <polyline points="6 9 6 2 18 2 18 9"/>
          <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/>
          <rect x="6" y="14" width="12" height="8"/>
        </svg>
        Print
      </button>

      <button class="select-mode-btn" id="select-mode-btn" aria-label="Select files for download" title="Select files">
        <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="18" height="18" rx="2"/>
          <polyline points="9 11 12 14 22 4"/>
        </svg>
        Select
      </button>

      <button class="slideshow-btn hidden" id="slideshow-btn" aria-label="Start slideshow" title="Start slideshow">
        <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24"
             fill="currentColor" stroke="none">
          <polygon points="5 3 19 12 5 21 5 3"/>
        </svg>
        Slideshow
      </button>

      <!-- AI tagging toggle (M8) -->
      <button class="ai-btn" id="ai-btn" title="Tag images with AI (on-device, private)">
        <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round">
          <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/>
          <line x1="7" y1="7" x2="7.01" y2="7"/>
        </svg>
        AI Tags
      </button>

      <select class="sort-sel" id="sort-sel" aria-label="Sort order">
        <option value="name-asc">Name Aâ†’Z</option>
        <option value="name-desc">Name Zâ†’A</option>
        <option value="date-desc">Newest first</option>
        <option value="date-asc">Oldest first</option>
        <option value="size-desc">Largest first</option>
        <option value="size-asc">Smallest first</option>
        <option value="timeline">Timeline</option>
      </select>

      <!-- M14: Manual refresh + poll interval (shown in event mode) -->
      <button class="refresh-btn hidden" id="refresh-btn" aria-label="Refresh photos" title="Check for new photos">
        <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round">
          <polyline points="23 4 23 10 17 10"/>
          <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
        </svg>
      </button>
      <select class="poll-interval-sel hidden" id="poll-interval-sel" aria-label="Auto-refresh interval" title="Auto-refresh interval">
        <option value="15000">Every 15s</option>
        <option value="30000" selected>Every 30s</option>
        <option value="60000">Every 60s</option>
      </select>

      <span class="file-count" id="file-count"></span>
      <span class="ai-status hidden" id="ai-status"></span>
    </div>

    <!-- M15: Contributors panel (shown in event mode) -->
    <div class="contributors-panel hidden" id="contributors-panel"></div>

    <!-- M15: Curation bar (shown in host event mode) -->
    <div class="curation-bar hidden" id="curation-bar">
      <button class="curation-btn" id="curation-hide-btn" title="Click photos to hide them from guests">
        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round">
          <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94"/>
          <path d="M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19"/>
          <line x1="1" y1="1" x2="23" y2="23"/>
        </svg>
        Hide
      </button>
      <button class="curation-btn" id="curation-feature-btn" title="Click photos to feature them at the top">
        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round">
          <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
        </svg>
        Feature
      </button>
      <div class="curation-sep"></div>
      <button class="curation-share-btn" id="curation-share-btn">Share Gallery</button>
      <button class="curation-thanks-btn" id="curation-thanks-btn">Thank You Page</button>
    </div>

    <div class="grid" id="grid" role="list"></div>

    <div class="load-more-wrap hidden" id="load-more-wrap">
      <button class="load-more-btn" id="load-more-btn">Load more files</button>
    </div>
  </div>

  <!-- UPLOAD PAGE (M13) â€” shown when ?event=<id>&upload=1 -->
  <div class="upload-page hidden" id="upload-page">
    <div class="upload-header" id="upload-header" data-style="warm-gold">
      <div class="upload-logo">Darkroom</div>
      <div class="upload-event-name" id="upload-event-name"></div>
      <div class="upload-event-date" id="upload-event-date"></div>
    </div>
    <div class="upload-body">
      <div class="upload-count-row">
        <span class="upload-count" id="upload-count">Loadingâ€¦</span>
      </div>
      <div class="upload-guest-field">
        <label class="upload-label" for="guest-name">Your Name</label>
        <input class="upload-input" id="guest-name" type="text"
               placeholder="Enter your nameâ€¦" autocomplete="name" maxlength="60" spellcheck="false">
      </div>
      <!-- Guest sign-in prompt (shown before auth) -->
      <div class="upload-auth-prompt" id="upload-auth-prompt">
        <p class="upload-auth-desc">
          Sign in with Google to upload your photos. We only access files you upload â€”
          nothing else in your Drive.
        </p>
        <button class="upload-signin-btn" id="upload-signin-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 48 48">
            <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>
            <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>
            <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>
            <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/>
          </svg>
          Continue with Google
        </button>
      </div>
      <!-- Upload UI (shown after guest auth) -->
      <div class="upload-ui hidden" id="upload-ui">
        <input type="file" id="file-picker" multiple accept="image/*,video/*" style="display:none">
        <button class="add-photos-btn" id="add-photos-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="1.5"
               stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="2"/>
            <circle cx="8.5" cy="8.5" r="1.5"/>
            <polyline points="21 15 16 10 5 21"/>
            <line x1="16" y1="5" x2="21" y2="5"/>
            <line x1="18.5" y1="2.5" x2="18.5" y2="7.5"/>
          </svg>
          Add Photos &amp; Videos
        </button>
        <div class="upload-list" id="upload-list"></div>
        <div class="upload-done-msg hidden" id="upload-done-msg">
          <div class="upload-done-icon">ðŸŽ‰</div>
          <div class="upload-done-text">Photos uploaded! Thank you.</div>
          <button class="upload-more-btn" id="upload-more-btn">Upload More</button>
        </div>
      </div>
    </div>
    <div class="upload-footer">
      Powered by <strong>Darkroom</strong>
    </div>
  </div>

  <!-- STATS DISPLAY (M14) â€” shown when ?event=<id>&display=stats -->
  <div class="stats-display hidden" id="stats-display">
    <div class="stats-display-event-name" id="stats-display-event-name"></div>
    <div class="stats-display-counter" id="stats-display-counter">0</div>
    <div class="stats-display-label">photos collected</div>
    <div class="stats-display-qr" id="stats-display-qr"></div>
    <div class="stats-display-hint">Scan to add your photos</div>
  </div>

  <!-- THANKS PAGE (M15) â€” shown when ?event=<id>&view=thanks -->
  <div class="thanks-page hidden" id="thanks-page">
    <div class="thanks-header">
      <div class="thanks-event-name" id="thanks-event-name"></div>
      <div class="thanks-event-date" id="thanks-event-date"></div>
    </div>
    <div class="thanks-stats" id="thanks-stats"></div>
    <div class="thanks-grid" id="thanks-grid"></div>
    <div class="thanks-actions">
      <a class="thanks-gallery-btn" id="thanks-gallery-btn" href="#">View Full Gallery</a>
      <button class="thanks-download-btn" id="thanks-download-btn">Download All</button>
    </div>
    <div class="powered-by">Powered by <strong>Darkroom</strong></div>
  </div>

</main>

<!-- ===================================
     LIGHTBOX
=================================== -->
<div class="lightbox hidden" id="lightbox" role="dialog" aria-modal="true">
  <button class="lb-x" id="lb-x" aria-label="Close">
    <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24"
         fill="none" stroke="currentColor" stroke-width="2.2"
         stroke-linecap="round" stroke-linejoin="round">
      <path d="M18 6 6 18M6 6l12 12"/>
    </svg>
  </button>
  <button class="lb-nav-btn lb-prev" id="lb-prev" aria-label="Previous">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
         fill="none" stroke="currentColor" stroke-width="2"
         stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
  </button>
  <button class="lb-nav-btn lb-next" id="lb-next" aria-label="Next">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
         fill="none" stroke="currentColor" stroke-width="2"
         stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
  </button>
  <div class="lb-body" id="lb-body"></div>
  <div class="lb-footer">
    <div class="lb-name" id="lb-name"></div>
    <div class="lb-ctr"  id="lb-ctr"></div>
    <a  class="lb-open" id="lb-open" target="_blank" rel="noopener noreferrer">Open in Drive â†—</a>
  </div>
</div>

<!-- ===================================
     SETTINGS MODAL
=================================== -->
<div class="settings-modal hidden" id="settings-modal" role="dialog" aria-modal="true" aria-label="API Key Settings">
  <div class="settings-panel">
    <div class="settings-head">
      <div class="settings-title">API Key</div>
      <button class="settings-close" id="settings-close" aria-label="Close settings">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" stroke-width="2.2"
             stroke-linecap="round" stroke-linejoin="round">
          <path d="M18 6 6 18M6 6l12 12"/>
        </svg>
      </button>
    </div>
    <p class="settings-desc">
      Darkroom needs a Google Drive API key to list folder contents.
      Keys are stored only in your browser â€” never sent anywhere else.
    </p>
    <div class="settings-steps">
      <span>1. Go to <a href="https://console.cloud.google.com/" target="_blank" rel="noopener noreferrer">Google Cloud Console</a></span>
      <span>2. Create project â†’ Enable <strong>Google Drive API</strong></span>
      <span>3. Credentials â†’ <strong>Create API Key</strong></span>
      <span>4. Restrict key to <strong>HTTP referrers</strong> (your domain)</span>
    </div>
    <div class="settings-field">
      <input class="api-key-input" id="api-key-input" type="password"
             placeholder="AIzaâ€¦" autocomplete="off" spellcheck="false">
      <button class="api-key-save" id="api-key-save">Save</button>
    </div>
    <button class="api-key-clear" id="api-key-clear">Clear saved key</button>

    <!-- OAuth section (M7) -->
    <div class="settings-sep"></div>
    <div class="settings-subtitle">Private Folders</div>
    <p class="settings-desc">
      Sign in with Google to browse folders that aren't publicly shared.
      Requires an OAuth 2.0 Client ID from your Google Cloud project.
    </p>
    <div class="settings-steps">
      <span>1. Go to <a href="https://console.cloud.google.com/" target="_blank" rel="noopener noreferrer">Google Cloud Console</a></span>
      <span>2. Credentials â†’ <strong>Create OAuth 2.0 Client ID</strong> (Web application)</span>
      <span>3. Add your origin to <strong>Authorized JavaScript origins</strong></span>
    </div>
    <div class="settings-field">
      <input class="api-key-input" id="client-id-input" type="text"
             placeholder="*.apps.googleusercontent.com" autocomplete="off" spellcheck="false">
      <button class="api-key-save" id="client-id-save">Save</button>
    </div>
    <button class="api-key-clear" id="client-id-clear">Clear Client ID</button>

    <!-- Plan section (M11) -->
    <div class="settings-sep"></div>
    <div class="settings-subtitle">Your Plan</div>
    <div class="settings-plan">
      <span class="plan-badge plan-free">Free</span>
      <span class="plan-desc">Public folders Â· 500 files Â· Core gallery</span>
    </div>
    <a class="plan-upgrade-link" href="pricing.html" target="_blank" rel="noopener noreferrer">
      View plans &amp; upgrade â†’
    </a>
  </div>
</div>

<!-- ===================================
     EMBED CODE MODAL (M9)
=================================== -->
<div class="embed-modal hidden" id="embed-modal" role="dialog" aria-modal="true" aria-label="Get Embed Code">
  <div class="embed-panel">
    <div class="embed-head">
      <div class="embed-title">Embed Gallery</div>
      <button class="embed-close" id="embed-close" aria-label="Close embed modal">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" stroke-width="2.2"
             stroke-linecap="round" stroke-linejoin="round">
          <path d="M18 6 6 18M6 6l12 12"/>
        </svg>
      </button>
    </div>
    <p class="embed-desc">
      Embed this gallery inline on any blog, portfolio, or website using an iframe.
      The lightbox, search, and filters all work inside the embed.
    </p>
    <div class="embed-controls">
      <div class="embed-field">
        <label class="embed-label" for="embed-width">Width</label>
        <input class="embed-input" id="embed-width" type="text" value="100%" placeholder="100% or 800px" autocomplete="off">
      </div>
      <div class="embed-field">
        <label class="embed-label" for="embed-height">Height</label>
        <input class="embed-input" id="embed-height" type="text" value="600px" placeholder="600px" autocomplete="off">
      </div>
    </div>
    <div class="embed-code-wrap">
      <pre id="embed-code" class="embed-code"></pre>
    </div>
    <button class="embed-copy-btn" id="embed-copy">
      <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24"
           fill="none" stroke="currentColor" stroke-width="2"
           stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2"/>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
      </svg>
      Copy Code
    </button>
  </div>
</div>

<!-- ===================================
     SLIDESHOW OVERLAY
=================================== -->
<div class="ss-overlay hidden" id="slideshow" role="dialog" aria-modal="true" aria-label="Slideshow">
  <div class="ss-body" id="ss-body"></div>
  <div class="ss-footer" id="ss-footer">
    <div class="ss-name" id="ss-name"></div>
    <div class="ss-ctr" id="ss-ctr"></div>
    <div class="ss-progress-wrap">
      <div class="ss-progress" id="ss-progress"></div>
    </div>
    <div class="ss-controls">
      <!-- M14: Live toggle for slideshow -->
      <button class="ss-ctrl-btn ss-live-btn hidden" id="ss-live-btn" aria-label="Toggle live mode" title="LIVE: auto-add new uploads to slideshow">
        <span class="live-dot"></span>LIVE
      </button>
      <button class="ss-ctrl-btn" id="ss-play-btn" aria-label="Pause">
        <svg id="ss-play-icon" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="10" y1="15" x2="10" y2="9"/>
          <line x1="14" y1="15" x2="14" y2="9"/>
        </svg>
      </button>
      <button class="ss-ctrl-btn" id="ss-fs-btn" aria-label="Toggle fullscreen">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="15 3 21 3 21 9"/>
          <polyline points="9 21 3 21 3 15"/>
          <line x1="21" y1="3" x2="14" y2="10"/>
          <line x1="3" y1="21" x2="10" y2="14"/>
        </svg>
      </button>
      <button class="ss-ctrl-btn ss-close-btn" id="ss-close" aria-label="Close slideshow">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M18 6 6 18M6 6l12 12"/>
        </svg>
      </button>
    </div>
  </div>
</div>

<!-- ===================================
     SELECTION BAR (M4)
=================================== -->
<div class="sel-bar hidden" id="sel-bar" role="toolbar" aria-label="File selection">
  <span class="sel-count" id="sel-count">0 selected</span>
  <div class="sel-actions">
    <button class="sel-action-btn" id="sel-all">Select all</button>
    <button class="sel-action-btn" id="sel-none">Clear</button>
  </div>
  <div class="sel-progress-wrap hidden" id="sel-progress-wrap">
    <div class="sel-progress-track">
      <div class="sel-progress-bar" id="sel-progress-bar"></div>
    </div>
    <span class="sel-progress-label" id="sel-progress-label"></span>
  </div>
  <button class="sel-download-btn" id="sel-download" disabled>
    <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24"
         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
      <polyline points="7 10 12 15 17 10"/>
      <line x1="12" y1="15" x2="12" y2="3"/>
    </svg>
    <span id="sel-download-label">Download ZIP</span>
  </button>
  <button class="sel-exit-btn" id="sel-exit" aria-label="Exit select mode">
    <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24"
         fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M18 6 6 18M6 6l12 12"/>
    </svg>
  </button>
</div>

<!-- MY DRIVE SIDEBAR (M7) -->
<div class="drive-sidebar hidden" id="drive-sidebar" role="navigation" aria-label="My Drive folders">
  <div class="drive-sidebar-hdr">
    <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24"
         fill="none" stroke="currentColor" stroke-width="1.5"
         stroke-linecap="round" stroke-linejoin="round">
      <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
    </svg>
    <span>My Drive</span>
  </div>
  <div id="drive-folders" class="drive-folders"></div>
</div>

<!-- DATE NAV SIDEBAR (M5) -->
<div class="date-nav hidden" id="date-nav" aria-label="Navigate by date" role="navigation"></div>

<!-- TIMELINE YEAR MINIMAP (M10) -->
<div class="tl-minimap hidden" id="tl-minimap" role="navigation" aria-label="Jump to year"></div>

<!-- ===================================
     LOCK GATE OVERLAY (M12)
=================================== -->
<div class="lock-overlay hidden" id="lock-overlay" role="dialog" aria-modal="true" aria-label="Gallery protected">
  <div class="lock-card">
    <div class="lock-logo">Darkroom</div>
    <div class="lock-icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"
           fill="none" stroke="currentColor" stroke-width="1.5"
           stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
        <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
      </svg>
    </div>
    <div class="lock-title">Gallery Protected</div>
    <p class="lock-desc">Enter the password to view this gallery.</p>
    <div class="lock-field">
      <input class="lock-input" id="lock-input" type="password"
             placeholder="Password" autocomplete="current-password" spellcheck="false">
      <button class="lock-btn" id="lock-btn">Unlock</button>
    </div>
    <div class="lock-error hidden" id="lock-error">Incorrect password. Please try again.</div>
  </div>
</div>

<!-- ===================================
     PROTECT MODAL (M12)
=================================== -->
<div class="protect-modal hidden" id="protect-modal" role="dialog" aria-modal="true" aria-label="Password protect gallery">
  <div class="protect-panel">
    <div class="protect-head">
      <div class="protect-title">Protect Gallery</div>
      <button class="protect-close" id="protect-close" aria-label="Close protect modal">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" stroke-width="2.2"
             stroke-linecap="round" stroke-linejoin="round">
          <path d="M18 6 6 18M6 6l12 12"/>
        </svg>
      </button>
    </div>
    <p class="protect-desc">
      Generate a password-protected link. Anyone with the link must enter the password to view the gallery.
      The password is hashed client-side â€” it never leaves your browser.
    </p>
    <div class="protect-field">
      <label class="protect-label" for="protect-input">Password</label>
      <input class="protect-input" id="protect-input" type="password"
             placeholder="Choose a passwordâ€¦" autocomplete="new-password" spellcheck="false">
    </div>
    <button class="protect-gen-btn" id="protect-gen">Generate Protected Link</button>
    <div class="protect-link-row hidden" id="protect-link-row">
      <div class="protect-link-wrap">
        <input class="protect-link-input" id="protect-link" type="text" readonly>
        <button class="protect-copy-btn" id="protect-copy">
          <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round">
            <rect x="9" y="9" width="13" height="13" rx="2"/>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
          </svg>
          Copy
        </button>
      </div>
      <p class="protect-note">Share this link. Recipients will need the password you chose above.</p>
    </div>
  </div>
</div>

<!-- ===================================
     EVENT CREATE MODAL (M13)
=================================== -->
<div class="event-create-modal hidden" id="event-create-modal" role="dialog" aria-modal="true" aria-label="Create New Event">
  <div class="event-create-panel">
    <div class="event-create-head">
      <div class="event-create-title">Create Event</div>
      <button class="event-create-close" id="event-create-close" aria-label="Close">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" stroke-width="2.2"
             stroke-linecap="round" stroke-linejoin="round">
          <path d="M18 6 6 18M6 6l12 12"/>
        </svg>
      </button>
    </div>
    <p class="event-create-desc">
      Set up a photo collection event. Guests scan a QR code to upload photos directly to your Google Drive.
    </p>
    <div class="event-create-field">
      <label class="event-create-label" for="event-name-input">Event Name</label>
      <input class="event-create-input" id="event-name-input" type="text"
             placeholder="e.g. Sarah &amp; Tom's Wedding" autocomplete="off" maxlength="80" spellcheck="false">
    </div>
    <div class="event-create-field">
      <label class="event-create-label" for="event-date-input">Event Date</label>
      <input class="event-create-input" id="event-date-input" type="date">
    </div>
    <div class="event-create-field">
      <label class="event-create-label">Cover Style</label>
      <div class="cover-style-picker" id="cover-style-picker">
        <button class="cover-swatch active" data-style="warm-gold" title="Warm Gold" aria-label="Warm Gold"></button>
        <button class="cover-swatch" data-style="cool-blue" title="Cool Blue" aria-label="Cool Blue"></button>
        <button class="cover-swatch" data-style="forest-green" title="Forest Green" aria-label="Forest Green"></button>
        <button class="cover-swatch" data-style="sunset-pink" title="Sunset Pink" aria-label="Sunset Pink"></button>
      </div>
    </div>
    <button class="event-create-btn" id="event-create-btn">
      <span id="event-create-btn-label">Create Event</span>
      <span class="event-create-spinner hidden" id="event-create-spinner"></span>
    </button>
    <p class="event-create-note" id="event-create-note"></p>
  </div>
</div>

<!-- ===================================
     QR SHARE MODAL (M13)
=================================== -->
<div class="qr-modal hidden" id="qr-share-modal" role="dialog" aria-modal="true" aria-label="Share Event">
  <div class="qr-panel">
    <div class="qr-head">
      <div class="qr-title" id="qr-event-name">Share Event</div>
      <button class="qr-close" id="qr-close" aria-label="Close">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" stroke-width="2.2"
             stroke-linecap="round" stroke-linejoin="round">
          <path d="M18 6 6 18M6 6l12 12"/>
        </svg>
      </button>
    </div>
    <!-- M15: Tab switcher (upload link / gallery link) -->
    <div class="qr-tabs" id="qr-tabs">
      <button class="qr-tab active" data-tab="upload" id="qr-tab-upload">Upload Link</button>
      <button class="qr-tab" data-tab="gallery" id="qr-tab-gallery">Gallery Link</button>
    </div>
    <div class="qr-body">
      <div class="qr-canvas-wrap" id="qr-canvas-wrap"></div>
      <p class="qr-hint" id="qr-hint">Guests scan this code to upload photos</p>
    </div>
    <div class="qr-url-row">
      <input class="qr-url-input" id="qr-url-input" type="text" readonly>
      <button class="qr-copy-btn" id="qr-copy-btn">Copy</button>
    </div>
    <div class="qr-actions">
      <button class="qr-action-btn" id="qr-download-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
          <polyline points="7 10 12 15 17 10"/>
          <line x1="12" y1="15" x2="12" y2="3"/>
        </svg>
        Download QR
      </button>
      <button class="qr-action-btn" id="qr-whatsapp-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"
             fill="currentColor" stroke="none">
          <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347"/>
        </svg>
        WhatsApp
      </button>
      <button class="qr-action-btn" id="qr-email-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"
             fill="none" stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round">
          <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
          <polyline points="22,6 12,13 2,6"/>
        </svg>
        Email
      </button>
    </div>
  </div>
</div>

<script src="script.js"></script>

</body>
</html>
